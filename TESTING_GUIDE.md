# CutieCam テストガイド

## 修正内容の概要

カメラ入力エラー「unable to add camera input」と写真の処理・保存の問題を修正しました。

## テスト環境の準備

### 必要なもの
- Xcode 15.0以上
- iOS 16.0以上を実行できるデバイスまたはシミュレーター
- （推奨）実機のiPhone - シミュレーターのカメラサポートは限定的

### プロジェクトのビルド手順

1. Xcodeで`CutieCam.xcodeproj`を開く
2. ターゲットデバイスを選択（iPhone 15シミュレーターまたは実機）
3. `Product` > `Clean Build Folder` (Shift+Cmd+K)
4. `Product` > `Run` (Cmd+R)

## テストシナリオ

### 1. カメラ権限のテスト

**手順**:
1. アプリを初回起動
2. カメラアクセス権限のダイアログが表示される
3. 「許可」をタップ

**期待される結果**:
- ダイアログが表示される
- 許可後、カメラプレビューが表示される

**確認ポイント**:
- Xcodeコンソールに`Camera session started: true`が表示される
- プレビュー画面にカメラの映像が表示される

---

### 2. カメラプレビューのテスト

**手順**:
1. カメラタブを開く
2. プレビュー画面を確認

**期待される結果**:
- リアルタイムのカメラプレビューが表示される
- 画面上部にフラッシュ、タイトル、設定ボタンが表示される
- 画面下部にギャラリー、シャッター、カメラ切り替えボタンが表示される

**確認ポイント**:
- プレビューが黒い画面でない
- UIが正しく配置されている

---

### 3. 写真撮影のテスト

**手順**:
1. カメラビューでシャッターボタン（中央の白い円）をタップ
2. 処理完了を待つ

**期待される結果**:
- 「Processing...」のローディング表示が出る
- PhotoEditorViewが表示される
- 撮影した写真が表示される

**Xcodeコンソールで確認**:
```
PhotoCaptureDelegate initialized
Photo capture started
Photo processing finished
Image data size: [数値] bytes
Successfully created UIImage: [サイズ]
Capture finished successfully
```

**トラブルシューティング**:
- ローディングが終わらない → コンソールでエラーを確認
- 写真が表示されない → デリゲート保持の問題（修正済み）

---

### 4. フィルター適用のテスト

**手順**:
1. カメラビューで下部の「No Filter」ボタンをタップ
2. フィルター一覧が表示される
3. 任意のフィルターを選択
4. シャッターボタンをタップ

**期待される結果**:
- フィルター一覧が表示される
- 選択したフィルター名が表示される
- 撮影後、フィルターが適用された写真が表示される

**確認ポイント**:
- フィルター選択がUIに反映される
- PhotoEditorで編集可能

---

### 5. フラッシュ切り替えのテスト

**手順**:
1. 左上のフラッシュアイコンをタップ
2. アイコンが変化することを確認
3. 写真を撮影

**期待される結果**:
- アイコンが`bolt.fill`（ON）と`bolt.slash.fill`（OFF）で切り替わる
- フラッシュON時、撮影時にフラッシュが発光（実機のみ）

---

### 6. カメラ切り替えのテスト

**手順**:
1. 右側のカメラ回転アイコンをタップ
2. カメラが切り替わることを確認
3. 再度タップして戻す

**期待される結果**:
- フロント/リアカメラが切り替わる
- プレビューが一瞬フリーズした後、新しいカメラの映像が表示される

**Xcodeコンソールで確認**:
```
Switching camera to: front
Removed current camera input
Successfully switched to front camera
```

**トラブルシューティング**:
- 切り替わらない → コンソールでエラーを確認
- 黒い画面になる → エラーリカバリーの確認（修正済み）

---

### 7. 写真編集のテスト

**手順**:
1. 写真を撮影してPhotoEditorViewを開く
2. 各スライダーを調整:
   - Exposure（露出）
   - Contrast（コントラスト）
   - Saturation（彩度）
   - Film Grain（フィルムグレイン）
   - Vignette（ビネット）
3. 「Reset」ボタンで元に戻す
4. 「Save to Library」ボタンをタップ

**期待される結果**:
- スライダー調整がリアルタイムで反映される
- Resetで元の画像に戻る
- 保存が成功し、成功ダイアログが表示される

**確認ポイント**:
- 処理中にローディング表示が出る
- 保存後に写真アプリで確認できる

---

### 8. フォトライブラリ権限のテスト

**手順**:
1. PhotoEditorViewで「Save to Library」をタップ
2. フォトライブラリアクセス権限のダイアログが表示される（初回のみ）
3. 「すべての写真へのアクセスを許可」または「選択した写真」をタップ

**期待される結果**:
- 権限ダイアログが表示される
- 許可後、写真が保存される
- 「Success! Photo saved to your library」が表示される

---

### 9. ギャラリービューのテスト

**手順**:
1. 下部タブバーから「Gallery」タブをタップ
2. 保存した写真が一覧表示される
3. 写真をタップ

**期待される結果**:
- 写真がグリッド形式で表示される
- 写真タップでPhotoEditorViewが開く
- 空の場合、「No Photos Yet」が表示される

---

### 10. プロフィールビューのテスト

**手順**:
1. 下部タブバーから「Profile」タブをタップ
2. プロフィール画面を確認
3. 「CutieCam Premium」をタップ

**期待される結果**:
- プロフィール情報が表示される
- サブスクリプション画面が開く
- 設定項目が一覧表示される

---

## パフォーマンステスト

### カメラ起動速度
- アプリ起動からカメラプレビュー表示まで: < 2秒

### 写真撮影速度
- シャッターボタンタップから撮影完了まで: < 1秒
- フィルター適用込みで < 3秒

### メモリ使用量
- カメラプレビュー中: < 100MB
- 写真処理中: < 150MB

## よくある問題と解決方法

### 問題: カメラプレビューが黒い

**原因**:
- カメラ権限が拒否されている
- セッションが開始されていない

**解決方法**:
1. 設定アプリ > CutieCam > カメラで権限を確認
2. アプリを再起動
3. Xcodeコンソールで`Camera session started: false`が出ていないか確認

---

### 問題: 写真が保存されない

**原因**:
- フォトライブラリ権限が拒否されている
- 保存処理でエラーが発生

**解決方法**:
1. 設定アプリ > CutieCam > 写真で権限を確認
2. Xcodeコンソールでエラーログを確認
3. 「Save to Library」を再度タップ

---

### 問題: シミュレーターでカメラが動作しない

**原因**:
- シミュレーターのカメラサポートは限定的

**解決方法**:
1. 実機でテスト
2. または、シミュレーターの「Debug」>「Environment Overrides」を確認

---

### 問題: フィルターが適用されない

**原因**:
- FilterService.swiftの実装が未完成
- 画像処理でエラーが発生

**解決方法**:
1. Xcodeコンソールでエラーを確認
2. FilterService.swiftの`applyFilter`メソッドを確認
3. フィルターパラメーターが正しく設定されているか確認

---

## バグ報告テンプレート

問題を発見した場合、以下の形式で報告してください：

```
### 問題の概要
[簡潔な説明]

### 再現手順
1. [ステップ1]
2. [ステップ2]
3. ...

### 期待される動作
[本来どうあるべきか]

### 実際の動作
[実際に起こったこと]

### 環境
- デバイス: [iPhone 15, シミュレーター、実機など]
- iOS: [16.0, 17.0など]
- Xcode: [15.0など]

### Xcodeコンソールのログ
```
[関連するログを貼り付け]
```

### スクリーンショット
[あれば添付]
```

## 次のステップ

テストが完了したら:

1. ✅ すべてのテストシナリオが成功
2. ✅ パフォーマンスが基準を満たしている
3. ✅ 重大なバグがない

→ プロダクションビルドの準備完了！

## 追加テストの推奨事項

- 異なるiPhoneモデルでテスト（SE、Pro、Plus）
- iPadでテスト
- 低速回線での動作確認
- メモリ不足状態での動作確認
- バックグラウンド/フォアグラウンド切り替え時の動作確認

